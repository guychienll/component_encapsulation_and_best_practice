---
marp: true
theme: default
paginate: true
---

# 元件設計

Date : 2025 Jul.
Author : Guy Lin

---


## 元件封裝 ( Component Encapsulation )

- 封裝能帶來的優點
- 不封裝帶來的缺點及後果

---

### 元件封裝帶來的優點

1) 增加維護性，元件邏輯內聚，不向外透露內部實作細節，實作只有一份
2) 元件可以被重複使用
3) 增加可測試性
4) 樣式統一

### 不封裝元件帶來的缺點

1) 維護性低，因未封裝，使用端需各自處理內部實作細節，增加使用困難度，並且同時讓相同邏輯發散在各處，實作有好幾份
2) 元件重複使用上困難
3) 可測試性低
4) 樣式歧異

---


### 在封裝上應避免的錯誤

1) 過度抽象/抽象不足
   - 過度抽象：可以由一元件承擔太多職責來觀察
   - 抽象不足：可以由一段程式片段反覆且同樣邏輯的出現觀察

2) 邏輯與 UI 耦合
   - 想重複使用一段邏輯，但該段邏輯卻被實作在某 UI 元件內部

3) 介面混亂
   - 參數過多或資料泥團

---

## 設計模式 ( Design Pattern )

- 並非銀彈，而是解決特定問題的方法
- 不同的設計模式會帶來不同的優缺點

---

### 常見元件設計模式

1) Compound Component
2) Render props
3) Higher Order Component

---

### Compound Component 適用時機

> 一個組件參數過於龐大，且通常其底下有相當可再細拆的元件，但這些元件擁有共同的 Context，此時可以考慮使用複合式元件 Compound Component 

- 優點：
    1) 減少父層組件介面參數量，分散給子元件，降低學習成本
    2) 因細小子元件拆分，可以將元件排列順序決定時間點後移，更加彈性

- 缺點:
    1) 因使用 context 造成，即使再細微的 context 變動，皆會造成整個元件重新渲染

---

### Render Props 適用時機

> 打破 React 原先的單向資料流，讓元件狀態有機會逆流而上，讓部分元件狀態可以適當的封裝在該元件上，並且可以更彈性的去因應相同邏輯做出不同的元件顯示

- 優點：
  1) 上對下，下對上，不透過 props 共享狀態
  2) 邏輯高內聚在封裝元件內

- 缺點：
  1) 有別於 React 單向資料流，會造成資料流向混亂，在複雜元件中，將會更難追蹤狀態流向
  2) 每次渲染，皆會重新建立 function instance 會造成子元件不必要渲染

---

### Higher Order Component 適用時機

> 讓元件可以有機會做橫向擴展，適用於做一些 auth guard / logging / error boundary 或一些本質為 decorator 目的的行為

- 優點：
  1) 可以在不改動原先實作下，做擴充。
  2) 高度重用性

- 缺點：
  1) 可讀性差
  2) 如有傳遞 ref 需求，會相較複雜

---

## 元件封裝實務經驗分享

- 如何在設計系統中統一樣式與行為
    > 可以於設計系統中基於 token based 方式調用樣式，並且將樣式邏輯獨立出來，避免與元件邏輯耦合，可以適當使用 tailwind-variants 等相似套件處理樣式行為。 
- 遇到 breaking changes 該如何應對
    > 如果不得已遇到 breaking changes，可以先觀察該元件使用範圍，如果範圍小，可嘗試一次性更改，但如果範圍大，建議採取漸進式替換，將原先實作 clone 一份，並且修改，讓新舊實作同時存在，舊實作標示棄用，且漸漸轉移到新實作上。
- 如何與設計師協作以達到一致性
    > 制定雙方討論驗收標準流程，建立 SOP。

---

## 總結

1) 適當抽象介面，減少參數，降低學習成本
2) 針對共用元件及邏輯做單元測試
3) 組合優先於繼承


---

## Thank for your listening

最後感謝大家的聆聽分享，若有任何問題或建議，歡迎隨時交流討論！希望這些經驗能對你在 React 元件設計與封裝上有所幫助。

